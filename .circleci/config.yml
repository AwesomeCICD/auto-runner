version: 2.1

orbs:
  terraform: circleci/terraform@2.1.0

jobs:
  runner:
    machine: true
    resource_class: crowley-namespace/runner-demo
    steps:
      - run: echo "Hi I'm on Runners!"
  
  deploy-runner-via-terraform:
    executor: terraform/default
    steps:
      - checkout
      - terraform/init:
          path: .
      - terraform/apply:
          path: .
          var_file: demo.tfvars
      - run:
          name: Terraform Output
          command: terraform output public_ip
    working_directory: ~/auto-runner/terraform/

workflows:
  demo:
    jobs:
      - deploy-runner-via-terraform